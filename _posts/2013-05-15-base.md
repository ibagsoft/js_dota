---
layout: post
title: Base(入门篇)
tags: class extend
description: 使用extend扩展类库
---



> 可通过添加微信公共帐号`icodekata`，或者微博帐号`姜志辉iS`与我讨论


## Base.extend

John Resing 曾经提到过一个Base库，由Dean Edwards开发。

让我们先来体验一下Base的基本用例：

	var Person = Base.extend({
		constructor: function(name) {
			this.name = name;
		},
		get_name: function() {
			return this.name;
		}
	});


	describe('Base', function() {
		it('extend', function() {
			var jobs = new Person('jobs');
			assert.equal('jobs', jobs.get_name());
		});
	});

### new Person

`var jobs = new Person('jobs')`。使用new构建对象，那么意味着Person必然是一个函数。其大概形式应该如`var Person = function(){}`的样子。因此，Base.extend返回的应该是一个function函数。

	var Base = {};
	Base.extend = function() {
		return function() {
			//...
		};
	};
	
### constructor

constructor的本意是作为构造函数来调用的。当使用`new Person('jobs')`时，会自动调用`constructor`的方法。所以我们需要在返加的function函数里调用constructor:

	return function() {
		if (typeof conf['constructor'] !== 'undefined') {
			conf['constructor'].apply(this, arguments);
		}
	};
	
这里涉及了三个知识点：

- Javascript的反射操作符typeof可以用来试着检索对象的属性
- Javascript的对象本身即是属性的容器，其中每个属性都拥有名字和值。所以可以使用for检索对象的属性，也可以使用[]获取属性的值。
- apply方法让我们构建一个参数数组传递给调用函数。

### get_name

`jobs.get_name()`应该是从extend()的参数继承而来的。那最简单的方法是将参数对象说明符中的方法复制给Person的实例。如我们之前所述Javascript的对象本身即是属性的容器。所以我们只需将参数的属性复制给Person的实例即可：

	return function() {
		if (typeof conf['constructor'] !== 'undefined') {
			conf['constructor'].apply(this, arguments);
		}
		for (var pro in conf) {
			this[pro] = conf[pro];
		}
	};
	
constructor属性其实不需要复制的，那么在复制之前需要通过`delete conf['constructor'];`将其删除。

###　小结

让我们把这些小构件联系起来，最终的代码如下：

	'use strict';
	var assert = require('assert');

	var Base = {};
	Base.extend = function(conf) {
		return function() {
			if (typeof conf['constructor'] !== 'undefined') {
				conf['constructor'].apply(this, arguments);
				delete conf['constructor'];
			}
			for (var pro in conf) {
				this[pro] = conf[pro];
			}
		};
	};

	var Person = Base.extend({
		constructor: function(name) {
			this.name = name;
		},
		get_name: function() {
			return this.name;
		}
	});


	describe('Base', function() {
		it('extend', function() {
			var jobs = new Person('jobs');
			assert.equal('jobs', jobs.get_name());
		});
	});